# General

- https://github.com/penetration-testing-execution-standard/ptes

## Metasploit

- armitage gui for easier network discovery
- msfcli for scripting?
- msfconsole interactive

### Modules

- exploit
- payload
- encoder: hiding from scanners
- nops: payload stability: try to prevent crashed when running payloads
- auxiliary: info gathering


# Information Gathering

## passive

### CLI

- whatweb
- [httrack](https://www.httrack.com/)
- [wafw00f](https://github.com/EnableSecurity/wafw00f)
- [sublist3r](https://github.com/aboul3la/Sublist3r)
- [theharvester](https://github.com/laramies/theHarvester)

### Firefox

- BuiltWith
- Wappaliyzer

### Web

- https://sitereport.netcraft.com/
- https://www.exploit-db.com/google-hacking-database
- https://dnsdumpster.com/
- https://www.domaincodex.com/
- https://netlas.io/
- https://fullhunt.io/
- https://binaryedge.io/
- https://haveibeenpwned.com/

## active

### CLI

- dig
  - `dig axfr <you know the rest>`
- dnsenum
- fierce
- nmap
- netdiscover
- smbmap
- rpcclient
- nmblookup
- msfconsole
- enum4linux
- hydra (bruteforce)
- dirb
- browsh
- nessus

#### Protocol enum

##### SMB

Usefull commands
- rpcclient
    - lookupnames: SID Lookup
- msfconsole
    - aux../scan/smb/smb_enumshares
    - aux../scan/smb/smb
    - aux../scan/smb/smb2
    - aux../scan/smb/smb_login
    - aux../scan/smb/pipe_auditor

##### FTP
- msfconsole
    - auxiliary/scanner/ftp/ftp_login

##### SSH

- nmap
    - ssh2-enum-algos
    - ssh2-hostkey --script-args ssh_hostkey=full
    - ssh-auth-methods --script-args="ssh.user=<user>"

##### HTTP

- nmap scripts
    - http-enum
    - http-headers
    - http-methods args http-methods.url-path=
    - http-webdav-scan
    - http-shellshock --script-args "https-shellshock.uri=<uri>"
- msfconsole
    - aux../scan/http/brute_dirs

##### mysql

- nmap
    - mysql-empty-password
    - mysql-info
    - mysql-users args mysqluser=<user>,mysqlpassword=<pass>
    - mysql-databases args ^^
    - mysql-audit args mysqlaudit.username= mysql-audit.password= mysql-audit.filename=/usr/share/nmap/nselib/data/mysql-cis.audit
    - mysql-dump-hashes args username= password=
- msfconsole
    - aux../scan/mysql/mysql_writeable_dirs
    - aux../scan/mysql/mysql_hashdump
    - aux../scan/mysql/mysql_login
- mssql query
    - load_file

##### MSSQL

- nmap
    - ms-sql-info
    - ms-sql-ntml-info args mssql.instance-port
    - ms-sql-nrute args userdb= passdb=
    - ms-sql-empty-password
    - ms-sql-query args mssql.username= mssql.password=,ms-sql-query.query=
    - ms-sql-dump-hashes args mssql.uername=,mssql.password=
    - ms-sql-xp-cmdshell args mssql.uername=,mssql.password=,ms-sql-xp-cmdshell.cmd=
- query
    - select * from master..syslogins
- metasploit
    - aux../scan/mssql/mssql_login
    - aux../admin/mssql/mssql_enum
    - aux../admin/mssql/mssql_enum_sql_logins
    - aux../admin/mssql/mssql_exec
    - aux../admin/mssql/mssql_enum_domain_accounts

### sniffing
- wireshark
- arp-scan
- ping
- fping
- zenmap
- nmap automator
- rustscan
- autorecon


### CVE

- nessus
- searchsploit
- [exploit-db.com](https://exploit-db.com)
- msfconsole
    - search command

### Auditing Tools

- SCAP Compliance Scanner
- Stigviewer

# Exploit

## msfvenom/metasploit cheat sheet

- msfvenom --list payloads
- msfconsole
    - use multi/handler setup payload listener
        - set same payload!

## webdav
- davtest
- cadaver
- msfconsole
    - exploit/windows/iis/iis_webdav_upad_asp
- msfvenom

## smb
- psexec
- msfconsole
    - exploit/windows/smb/psexec

## RDP
- msfconsole
    - aux.../scanner/rdp/rdp_scanner
- hydra
- xfreerdp /u:user /p:pw /v:host:port

## WinRM

port 5985

- crackmapexec
- evil-winrm
- msfconsole
    - aux/scanner/winrm/winrm_login
    - scanner/winrm/winrm_cmd

## Windows Kernel

- windows exploit suggester
- msfconsole
    - multi/recon/local_exploit_suggester

## Linux Kernel

- linux-exploit-suggester

## UAC

bypass uac prompt with access to an local administator

- UACMe

## Window Access Token

- managed by LSASS (Local Security Authority Subsystem Service)
- generated by winlogin.exe during login and passed to userinit.exe

- impersonate token (non interactive login)
    - local only
- delegate level token (interactive login, RDP)
    - can be used on other systems

Important priveleges to facilitate:

- SeAssignPrimaryToken
- SeCreateToken
- SeImpersonatePrivilege

Metersploit: Incognito

## ADS (Alternative Data Stream)

common evasion tatic to hide from users/administrators.

Pattern: `<visable-file>:<hidden filename>`

save a file `file:hidden` only file will the visible.

## Credentials Dumping

### Windows unattended installation paths

Files might be present here or in subdirectories:

- c:\Windows\Panther\Unattend.xml
- c:\Windows\Panther\Autounattend.xml

Secrets might be base64 encoded.

### SAM DB Hasdump

- mimikatz
- meterpreter session: kiwi extension

### Linux Hashes

Hash prefixes see [`crypt` man page](https://manpages.debian.org/testing/libcrypt-dev/crypt.5.en.html)

Common:

* `$1` MD5
* `$2` Blowfish
* `$5` SHA-256
* `$6` SHA-512
* `$y` yescrypt

# Privilege Escalation

- winPEAs

## Windows: pass-the-hash

- metaploit psexec module
    - windows/smb/psexec
      Requires LN and NTLM hashes: SMBPass <LN>:<NTLM>
      Try different target options if it does not work
- crackmapexec
- evil-winrm

## Linux SUID

- https://gtfobins.github.io/

# Network

## arp

you might want to enable routing first `/proc/sys/net/ipv4/ip_forward`

- arpspoof -i <if> -t <target> [-r, use this to poison booth hosts to get bidrirectional MITM access] <host to redirect>
